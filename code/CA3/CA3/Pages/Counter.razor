@page "/counter"
@using Newtonsoft.Json
@using System.Text.RegularExpressions
@inject HttpClient Http

<PageTitle>Chuck Norris Fact Search</PageTitle>

<h1>Search Jokes</h1>


<input type="text" placeholder="Enter search query" @bind="query" />
<button @onclick="Search">Search</button>

@if (jsonSearch != null)
{
        <ul>
        @foreach (var item in jsonSearch.value)
        {
            @item
        }
    </ul>
}
else
{
    <p>No value found!</p>
}


@code {

    private string query;
    private ApiResponseSearch jsonSearch;


    protected override async Task OnInitializedAsync()
    {
        // Initialize the list as an empty list
        jsonSearch = new ApiResponseSearch();
    }

    private async Task Search()
    {
        if (Regex.IsMatch(query, @"^[a-zA-Z]+$"))
        {
            // Make a HTTP GET request to the specified URL
            var response = await Http.GetAsync($"https://api.chucknorris.io/jokes/search?query={query}");

            // Read the response as a JSON object
            jsonSearch = JsonConvert.DeserializeObject<ApiResponseSearch>(await response.Content.ReadAsStringAsync());

            Console.WriteLine(jsonSearch);
        }
        else
        {
            // Show an error message to the user
            Console.WriteLine("Please enter a valid search query!");
        }
    }



    // API response model
    public class ApiResponseSearch
    {
        public List<string> categories { get; set; }
        public string created_at { get; set; }
        public string icon_url { get; set; }
        public string id { get; set; }
        public string updated_at { get; set; }
        public string url { get; set; }
        public string value { get; set; }
    }


}